# config.yaml - 新抗原分析流程配置文件
# ===================== 样本信息 =====================
# 支持批量样本扩展（格式：样本组ID: {tumor: 肿瘤样本名, normal: 正常样本名}）
samples:
  Pt13: 
    tumor: tumor
    normal: normal
  Pt17: 
    tumor: tumor
    normal: normal
  Pt18: 
    tumor: tumor
    normal: normal
  Pt102: 
    tumor: tumor
    normal: normal
  Pt104: 
    tumor: tumor
    normal: normal


# ===================== 资源配置 =====================
# 按工具特性分配线程（根据服务器核心数调整）
threads:
  fastqc: 8          # FastQC质控线程（轻量可并发更多）
  align: 24          # 比对/排序/去重线程（IO密集，增加线程提高利用率）
  hla: 8             # HLA分型（Optitype）线程
  mutect2: 16        # Mutect2每个区间线程（CPU密集，适度提升）
  vep: 16            # VEP注释线程（fork并发数）
  pvacseq_run: 32    # pVACseq新抗原预测线程（可并行较多但受IEDB限制）
  fastp: 4           # fastp质控线程（单任务适度降压，避免SSH阻塞）

# 可配置的 I/O 资源权重（用于 Snakemake resources.io 调度）
resources:
  io:
    fastp: 10                      # 提高权重以限制并发数量
    fastqc: 2
    align_and_dedup: 8             # 较重IO，限制一定并发
    hla_typing: 2
    mutect2_scatter: 3
    mutect2_gather: 2
    mutect2_merge_stats: 1
    learn_read_orientation_model: 2
    get_pileup_summaries: 2
    calculate_contamination: 2
    filter_mutect_calls: 2
    vep_annotate: 6               # 注释阶段IO也较重
    pvacseq_run: 8                # IEDB调用较重，适度限制

  # 单独的 fastp 并发槽，配合 --resources fastp_slots=1 实现串行或小并发
  fastp_slots: 1

mem:
  vep: 32G           # VEP内存分配

# ===================== 参考基因组与资源 =====================
# 建议使用GRCh38（临床分析首选），需提前下载并构建索引
ref_genome: "/home/longyh/database/GRCh38.d1.vd1.fa"  # 参考基因组FASTA文件路径
ref_dict: "/home/longyh/database/GRCh38.d1.vd1.dict"  # 对应参考的字典文件（用于 --sequence-dictionary）

# Mutect2必需资源（germline/PON）
germline_resource: "/home/longyh/database/af-only-gnomad.hg38.vcf.gz"  # gnomAD胚系突变库
panel_of_normals: "/home/longyh/database/1000g_pon.hg38.vcf.gz"  # 正常样本面板（PON）

# ===================== 基因组区间配置 =====================
# Mutect2 scatter-gather拆分区间（与generate_intervals规则输出对应）
# 若使用generate_intervals自动生成，此处可留空；手动指定则填写区间名列表
genome_intervals:
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0000-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0001-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0002-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0003-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0004-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0005-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0006-scattered.interval_list
  - /home/longyh/database/TruSeq_Exome_v1.2_GRCh38_split/0007-scattered.interval_list
  # 手动指定的TruSeq Exome捕获区间列表（已删除generate_intervals规则，直接使用此列表）
  # 生成方式：ls /database/TruSeq_Exome_v1.2_GRCh38_split/*.interval_list | sed 's/^/  - /'

# ===================== 工具路径与参数 =====================
# IEDB/NetMHCpan安装路径（pVACseq依赖）
netmhc_dir: "/home/longyh/software"  # NetMHCpan等工具安装目录

ic50_cutoff: 500  # IC50阈值（nM），<500为高亲和力

# VEP参数配置（可根据需求调整）
vep:
  cache_dir: /home/longyh/database/vep  # 替换为你实际的 VEP 缓存目录
  assembly: GRCh38              # 或 GRCh37，需与参考一致
  # extra_args: "--everything --allele_number --no_escape"  # 可选，按需扩展 

# pVACseq参数（可根据需求调整）
pvacseq:
  epitope_lengths: "8,9,10,11"  # 经典MHC I类表位长度
  net_chop_method: "cterm"       # 剪切位点预测方法
  netmhc_stab: true              # 是否启用NetMHCstab稳定性分析
  pass_only: true               # 仅保留PASS突变

# ===================== 输出路径（可选） =====================
# 若需自定义输出路径，可在此配置（默认已在Snakefile中定义）
output_dirs:
  bam: "bam"
  vcf: "vcf"
  results: "results"
  logs: "logs"
  qc: "qc"